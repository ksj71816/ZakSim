<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
  <mapper namespace="zaksim.dao.ReportDao">
  
  <resultMap type="zaksim.dto.ZakSimMember" id="ZakSimMember">
  	<result property="id" column="id"/>
  </resultMap>
  
  <resultMap type="zaksim.dto.Report" id="Report">
  	<result property="boardIdx" column="board_idx"/>
  	<result property="commentIdx" column="comment_idx"/>
  	<result property="reporterIdx" column="reporter_idx"/>
  	<result property="category" column="category"/>
  	<result property="reason" column="reason"/>
  	<result property="memberIdx" column="member_idx"/>
  	<result property="reportDate" column="report_date"/>
  	<collection property="reporterMember" resultMap="ZakSimMember"/>
  </resultMap>
  
  	<resultMap type="zaksim.dto.Board" id="Board">
		<result column="idx" property="idx" />
		<result column="challenge_idx" property="challenge_idx" />
		<result column="group_idx" property="group_idx" />
		<result column="writer_idx" property="writer_idx" />
		<result column="title" property="title" />
		<result column="content" property="content" />
		<result column="image" property="image" />
		<result column="storedName" property="storedName" />
		<result column="open" property="open" />
		<result column="certification" property="certification" />
		<result column="written_date" property="written_date" />
		<result column="hit" property="hit" />
	</resultMap>
	
  
  
  
  
  <!-- 신고 정보와 신고자 아이디 반환 -->
  <select id="selectReport" parameterType="zaksim.dto.ZakSimMember" resultMap="Report">
 	SELECT rz.*, m.id
 	FROM (
 		SELECT r.board_idx, r.comment_idx, r.reporter_idx, r.category, r.reason, r.member_idx, r.report_date
 		FROM Report r
 		WHERE r.member_idx = #{idx}) rz, ZakSimMember m
 	WHERE rz.reporter_idx=m.idx
  </select>
  
  <delete id="deleteReport" parameterType="int">
  	DELETE FROM report WHERE member_idx=#{index}
  </delete>
  
  <insert id="insertReport" parameterType="zaksim.dto.Report">
  	INSERT INTO REPORT (idx, board_idx, comment_idx, reporter_idx, category, reason, member_idx, report_date)
  	VALUES (Report_SEQ.NEXTVAL, #{boardIdx}, null, #{reporterIdx}, #{category}, #{reason}, #{memberIdx}, sysdate)
  </insert>
  
  <select id="selectReportBoard" parameterType="int" resultMap="Board">
  	SELECT *
  	FROM BOARD
  	WHERE idx=#{boardIdx}
  </select>
  
  </mapper>